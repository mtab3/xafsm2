オフラインで触ったので要チェック


改造中

○ 分光器：測定中はマニュアルで動かないようにロックする
            その為のフラグ立ては、外部での仕事にして、
　　　　　　2種類(マニュアル、測定)の「移動コマンド」は廃止

○ 測定結果のファイル名を、画面上の入力で変更しても、ダイアログの方が変わらない
○ 野村ファイルフォーマットに真剣に対応(以下残ってる問題点)
  ・記録する際の横軸単位指定は「度」か「度以外」とする。
  　「度以外」の時は全部エネルギーに直す。
　・パラメータファイルの名前書き出しはやってない
　・Ortec でも Camac でも無いので、Scaler を「SCALE」とし、そのコードを「2」にした。
　・Offest はまだ真面目に扱ってない
　・FLUO のとき、各チャンネルのモードを真面目に書いてない
　・各点の記録にエンコーダのよみを入れていない
　・各点の記録は野村フォーマットを無視してI0と測定に使ったチャンネルのデータを
	ずらっと並べただけ
　・ヘッダ部分に終了時でないとかけない情報がある、今は、置換用の記号を埋めるだけで
　　実際の再読み込み + 置換はやってない

○ BLC2 から Stars サーバのアドレス等の設定関係のコードを移植 動いてるか?

○ Keithley の測定時間設定をどうするか再考の必要あり
○ XAFSM.def にドライバ名のリストを入れた。
　そのうち Stars との接続時に listnodes をやって、ドライバが揃っているかどうかの確認を
　やるつもり
○ 仮のコードだった個々のStars クライアントとの通信コードを実コードと置き換えはじめる。
  1. nct08 対応済 (もう少し細かいチェック必要)
　2. Keithley とりあえず実装 : 未確認
　3. エンコーダ　スケルトン実装
　4. ピエゾ　スケルトン実装
○ 軸の位置はエンコーダで判断するようにする
○ モータのパルスで見た角度とエンコーダで見た角度の整合をとる
○ ファイル書き出し全くおこなっていない
○ マルチディテクタをファイルに記録する際にどうやって対応するか
○ ピークスキャン部分コメントアウトしたまま
○ タイムチャート部分コメントアウトしたまま
○ グラフ表示部分を直接 XView にせず、コントロールを含んだコンテナにする
○ アイデアとしては以下のように完全 Timer 排除ができるはず。
   測定開始時に emit - connect で、MeasSequence を呼び出す。
   MeasSequence からは、必ず Stars のコマンドを一つは発行してから抜けるようにする。
   発行されたコマンドに対する Stars からの応答を受ける関数の中から emit-connect で
   MeasSequence を呼び出す。
○ GUI をもう少しビューティフルに
○ umi と統合とかありえるか? 

やること 2011.2.16 〜

○ データファイル書き出しを真面目に
○ ダーク測定
○ バッチ処理
○ 設定ファイルの読み書き
○ グラフ中にカーソル
○ Monitor
○ 測定データ表示 (データを読み出して表示)
○ 単なる最大値決定になってるピーク位置決定を真面目にやる
○ 縦軸のスケール決定がダメすぎ

○ SSD 設定画面
○ SSD 横軸補正
○ 吸収係数の計算統合？
○ I, I0 のお勧めガス表示

#########################################################################

対処済み 2012.10〜

○ Stars.cpp ConnectionStage は enum にする。
   (SendCMD 等で最終ステージに着てるかどうかをちぇっくする)
○ ConnectionStage の 2段階目で Stars からの応答をチェックするようにした
○ Stars.cpp 接続開始をイベントドリブンにした
○ show は Initialize の後にしたいけど今はやってない。
○ 相手を変えて ReConnect 正しい相手にして ReConnect しないと繋がらなかったのを修正
○ グラフ表示のスケール決定がメチャクチャ。ー＞とりあえずは見られるようになった
○ 検出器ごとにデータ取り扱い法を指定できるようにする。
   log(I0/I1), I/I0, ... 等
○ nct08 の GetValue 関係で、一つ前の値を読んでしまっている。
○ MwSetup で、一般のモータ移動の欄 BLC2 版の Stars 通信に対応済
○ MwSetup で、モータの名前と実際に指定されるモータがずれていた
○ それに合わせて、BLC2 同様に別名を使えるように変更
   XAFSM.def の中の XAFSName, XAFSKey, XAFSTitle
○ BLC2 のコードを元に、軸の移動や検出器の操作等をポーリングでなくイベント駆動に書き換える
○ 仮のコードだった個々のStars クライアントとの通信コードを実コードと置き換えはじめる。
  0. pm16c04 対応済み
○ センサーの初期化処理を「どかん」とやってしまってる。
   ---> 少なくとも測定開始時は丁寧にやるようにした
○ 周期表での測定対象元素指定

○ 野村ファイルフォーマットに真剣に対応中
　・どうせ野村フォーマットにしないなら、エネルギーと角度を両方書いた方がいい


対処済 2011.2.16 〜

○ 計測中の現在位置表示 (繰り返し何回目、何ブロック目、何ステップ目) : 取り合えず OK
○ BlockStart ... は、計測開始時にコピーして使う (Repeat だけは計測中に変更可)
○ pause を生かす
○ stop 時の「ほんとに？」ダイアログ。
○ 終了時の戻り位置指定
○ 見積り測定時間の表示
○ 測定開始前のデータ点検
○ Stars との接続 (その先の dummy デバイスとの接続)
○ 作業ログ
○ データのリアルタイム表示
○ 結晶変更 (プログラム側での変更だけ)
○ Stars シミュレーションコード削除
○ モーターの単純移動
○ Scan/Search の実装
○ SoPS: 相対移動をもう少し考える(width 指定、始点終点指定の使い分け)
○ ピーク位置決定
○ SoPS: スキャン中のモータの位置表示位置を考える
